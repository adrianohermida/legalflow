<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Loading Issues - LegalFlow</title>
    <style>
        body {
            font-family: system-ui;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .status.info { background: #e3f2fd; border-color: #2196f3; }
        .status.success { background: #e8f5e8; border-color: #4caf50; }
        .status.warning { background: #fff3e0; border-color: #ff9800; }
        .status.error { background: #ffebee; border-color: #f44336; }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
        .test-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .test-link {
            display: block;
            padding: 10px;
            background: #2196f3;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            text-align: center;
        }
        .test-link:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug Loading Issues</h1>
        
        <div id="status-container">
            <div class="status info">
                <h3>üìã Iniciando diagn√≥stico...</h3>
                <p>Verificando por que o React app n√£o est√° carregando.</p>
            </div>
        </div>

        <div class="status">
            <h3>üîó Links de Teste</h3>
            <div class="test-links">
                <a href="/" class="test-link">üè† App Principal</a>
                <a href="/dashboard" class="test-link">üìä Dashboard</a>
                <a href="/processos" class="test-link">‚öñÔ∏è Processos</a>
                <a href="/clientes" class="test-link">üë• Clientes</a>
                <a href="/debug-app-loading.html" class="test-link">üõ†Ô∏è Debug App</a>
                <a href="/verificacao-sistema-completo.html" class="test-link">‚úÖ Verifica√ß√£o</a>
            </div>
        </div>

        <div class="status">
            <h3>üìù Console Logs</h3>
            <pre id="console-output">Aguardando logs...</pre>
        </div>

        <div class="status">
            <h3>üåê Network Status</h3>
            <pre id="network-status">Verificando...</pre>
        </div>

        <div class="status">
            <h3>‚öôÔ∏è App Status</h3>
            <pre id="app-status">Verificando...</pre>
        </div>
    </div>

    <script>
        const statusContainer = document.getElementById('status-container');
        const consoleOutput = document.getElementById('console-output');
        const networkStatus = document.getElementById('network-status');
        const appStatus = document.getElementById('app-status');
        
        let logs = [];
        
        // Capturar console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = `[${timestamp}] [${type.toUpperCase()}] ${args.join(' ')}`;
            logs.push(message);
            consoleOutput.textContent = logs.slice(-20).join('\n');
            
            // Call original functions
            if (type === 'log') originalLog(...args);
            if (type === 'error') originalError(...args);
            if (type === 'warn') originalWarn(...args);
        }
        
        console.log = (...args) => addLog('log', ...args);
        console.error = (...args) => addLog('error', ...args);
        console.warn = (...args) => addLog('warn', ...args);
        
        console.log('üöÄ Debug iniciado');
        
        async function runDiagnosis() {
            try {
                // 1. Verificar se conseguimos acessar o index.html
                console.log('üìç Testando acesso ao index.html...');
                
                const indexResponse = await fetch('/');
                console.log(`üìÑ Index response: ${indexResponse.status}`);
                
                if (indexResponse.ok) {
                    const indexContent = await indexResponse.text();
                    console.log(`üìè Index size: ${indexContent.length} chars`);
                    
                    // Verificar se o script est√° sendo carregado
                    if (indexContent.includes('/client/App.tsx')) {
                        console.log('‚úÖ Script App.tsx encontrado no index.html');
                    } else {
                        console.log('‚ùå Script App.tsx N√ÉO encontrado no index.html');
                    }
                    
                    // 2. Tentar carregar o App.tsx diretamente
                    console.log('üìç Testando carregamento do App.tsx...');
                    
                    try {
                        const appResponse = await fetch('/client/App.tsx');
                        console.log(`üìÑ App.tsx response: ${appResponse.status}`);
                        
                        if (appResponse.ok) {
                            const appContent = await appResponse.text();
                            console.log(`üìè App.tsx size: ${appContent.length} chars`);
                            
                            // 3. Tentar importar como m√≥dulo
                            console.log('üìç Testando import do m√≥dulo...');
                            
                            const module = await import('/client/App.tsx');
                            console.log('‚úÖ M√≥dulo App.tsx importado com sucesso!');
                            console.log('üì¶ Exports:', Object.keys(module));
                            
                            statusContainer.innerHTML += `
                                <div class="status success">
                                    <h3>‚úÖ App.tsx carregando corretamente</h3>
                                    <p>M√≥dulo importado com sucesso. O problema pode estar na inicializa√ß√£o do React.</p>
                                </div>
                            `;
                            
                        } else {
                            console.error(`‚ùå Erro ao carregar App.tsx: ${appResponse.status}`);
                            statusContainer.innerHTML += `
                                <div class="status error">
                                    <h3>‚ùå Erro ao carregar App.tsx</h3>
                                    <p>Status: ${appResponse.status}</p>
                                </div>
                            `;
                        }
                        
                    } catch (appError) {
                        console.error('‚ùå Erro ao importar App.tsx:', appError);
                        statusContainer.innerHTML += `
                            <div class="status error">
                                <h3>‚ùå Erro de importa√ß√£o do App.tsx</h3>
                                <pre>${appError.message}</pre>
                            </div>
                        `;
                    }
                    
                } else {
                    console.error(`‚ùå Erro ao acessar index.html: ${indexResponse.status}`);
                    statusContainer.innerHTML += `
                        <div class="status error">
                            <h3>‚ùå Erro ao acessar p√°gina principal</h3>
                            <p>Status: ${indexResponse.status}</p>
                        </div>
                    `;
                }
                
                // 4. Verificar o DOM
                console.log('üìç Verificando DOM...');
                const rootElement = document.querySelector('#root');
                if (rootElement) {
                    console.log('‚úÖ Elemento #root encontrado no DOM principal');
                } else {
                    console.log('‚ùå Elemento #root N√ÉO encontrado');
                }
                
                // 5. Informa√ß√µes do ambiente
                console.log('üìç Informa√ß√µes do ambiente:');
                console.log(`- URL: ${window.location.href}`);
                console.log(`- User Agent: ${navigator.userAgent}`);
                console.log(`- Timestamp: ${new Date().toISOString()}`);
                
                networkStatus.textContent = `
URL atual: ${window.location.href}
Protocolo: ${window.location.protocol}
Host: ${window.location.host}
Pathname: ${window.location.pathname}
                `;
                
                appStatus.textContent = `
React dispon√≠vel: ${typeof React !== 'undefined' ? 'Sim' : 'N√£o'}
ReactDOM dispon√≠vel: ${typeof ReactDOM !== 'undefined' ? 'Sim' : 'N√£o'}
Vite HMR: ${typeof window.__vite_plugin_react_preamble_installed__ !== 'undefined' ? 'Sim' : 'N√£o'}
                `;
                
            } catch (error) {
                console.error('‚ùå Erro geral no diagn√≥stico:', error);
                statusContainer.innerHTML += `
                    <div class="status error">
                        <h3>‚ùå Erro geral no diagn√≥stico</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        // Executar diagn√≥stico
        runDiagnosis();
        
        // Verificar mudan√ßas no DOM principal a cada segundo
        let checkCount = 0;
        const checker = setInterval(() => {
            checkCount++;
            
            try {
                // Tentar acessar o DOM principal
                const mainRoot = window.parent?.document?.getElementById('root') || 
                                 window.top?.document?.getElementById('root');
                
                if (mainRoot && mainRoot.children.length > 0) {
                    console.log('‚úÖ React app detectado no DOM principal!');
                    statusContainer.innerHTML += `
                        <div class="status success">
                            <h3>‚úÖ React App Detectado!</h3>
                            <p>O aplicativo foi carregado no DOM principal ap√≥s ${checkCount} verifica√ß√µes.</p>
                        </div>
                    `;
                    clearInterval(checker);
                } else if (checkCount >= 10) {
                    console.log('‚ö†Ô∏è React app ainda n√£o detectado ap√≥s 10 verifica√ß√µes');
                    statusContainer.innerHTML += `
                        <div class="status warning">
                            <h3>‚ö†Ô∏è React App n√£o detectado</h3>
                            <p>Ap√≥s 10 verifica√ß√µes, o app ainda n√£o foi carregado no DOM.</p>
                        </div>
                    `;
                    clearInterval(checker);
                }
            } catch (e) {
                // Ignore cross-origin errors
                if (checkCount >= 10) {
                    clearInterval(checker);
                }
            }
        }, 1000);
        
        console.log('‚úÖ Diagn√≥stico iniciado');
    </script>
</body>
</html>
