<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LegalFlow - Test de Carregamento Completo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: system-ui;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .test-container {
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        width: 90%;
      }
      .test-status {
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        font-weight: 500;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      h1 {
        color: #327a5b;
        margin-bottom: 30px;
        text-align: center;
      }
      h2 {
        color: #495057;
        margin: 20px 0 10px 0;
      }
      button {
        background: #327a5b;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 5px;
        font-size: 14px;
      }
      button:hover {
        background: #285e4a;
      }
      .log {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        font-family: monospace;
        white-space: pre-wrap;
        margin: 10px 0;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ LegalFlow - Teste de Carregamento</h1>

      <h2>1. Testes de Ambiente</h2>
      <div id="env-tests"></div>

      <h2>2. Testes de React</h2>
      <div id="react-tests"></div>

      <h2>3. Testes de API</h2>
      <div id="api-tests"></div>

      <h2>4. Testes de Builder.io</h2>
      <div id="builder-tests"></div>

      <h2>5. Logs do Sistema</h2>
      <div id="system-logs" class="log"></div>

      <div style="text-align: center; margin-top: 30px">
        <button onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
        <button onclick="loadMainApp()">üè† Carregar App Principal</button>
        <button onclick="window.location.reload()">üîÑ Recarregar</button>
      </div>
    </div>

    <script>
      let logs = [];

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        logs.push(`[${timestamp}] ${message}`);
        updateLogs();
        console.log(message);
      }

      function updateLogs() {
        document.getElementById("system-logs").textContent = logs.join("\n");
      }

      function addStatus(containerId, message, type) {
        const container = document.getElementById(containerId);
        const div = document.createElement("div");
        div.className = `test-status ${type}`;
        div.textContent = message;
        container.appendChild(div);
      }

      // 1. Teste de Ambiente
      function testEnvironment() {
        log("üîç Iniciando testes de ambiente...");

        // Verificar se est√° no Builder.io
        const isBuilder =
          window.location.hostname.includes("builder.io") ||
          window.location.hostname.includes("fly.dev");

        if (isBuilder) {
          addStatus("env-tests", "‚úÖ Ambiente Builder.io detectado", "success");
          log("‚úÖ Executando no Builder.io");
        } else {
          addStatus("env-tests", "‚ö†Ô∏è Ambiente local detectado", "warning");
          log("‚ö†Ô∏è Executando localmente");
        }

        // Verificar console
        if (typeof console !== "undefined") {
          addStatus("env-tests", "‚úÖ Console dispon√≠vel", "success");
        } else {
          addStatus("env-tests", "‚ùå Console n√£o dispon√≠vel", "error");
        }

        // Verificar DOM
        if (document.getElementById("root")) {
          addStatus("env-tests", "‚úÖ Elemento #root encontrado", "success");
        } else {
          addStatus("env-tests", "‚ùå Elemento #root n√£o encontrado", "error");
        }
      }

      // 2. Teste de React
      function testReact() {
        log("‚öõÔ∏è Iniciando testes de React...");

        // Tentar carregar React
        return new Promise((resolve) => {
          const script = document.createElement("script");
          script.src = "https://unpkg.com/react@18/umd/react.development.js";
          script.onload = () => {
            if (typeof React !== "undefined") {
              addStatus(
                "react-tests",
                "‚úÖ React carregado com sucesso",
                "success",
              );
              log("‚úÖ React dispon√≠vel");

              // Testar createElement
              try {
                const element = React.createElement("div", null, "Teste");
                addStatus(
                  "react-tests",
                  "‚úÖ React.createElement funcionando",
                  "success",
                );
                log("‚úÖ React.createElement OK");
              } catch (e) {
                addStatus(
                  "react-tests",
                  "‚ùå Erro em React.createElement: " + e.message,
                  "error",
                );
                log("‚ùå Erro React.createElement: " + e.message);
              }
            } else {
              addStatus(
                "react-tests",
                "‚ùå React n√£o p√¥de ser carregado",
                "error",
              );
              log("‚ùå React n√£o dispon√≠vel");
            }
            resolve();
          };
          script.onerror = () => {
            addStatus("react-tests", "‚ùå Falha ao carregar React", "error");
            log("‚ùå Falha ao carregar React");
            resolve();
          };
          document.head.appendChild(script);
        });
      }

      // 3. Teste de API
      async function testAPI() {
        log("üåê Iniciando testes de API...");

        try {
          const response = await fetch("/api/health");
          if (response.ok) {
            addStatus("api-tests", "‚úÖ API de sa√∫de respondendo", "success");
            log("‚úÖ API health OK");
          } else {
            addStatus(
              "api-tests",
              "‚ö†Ô∏è API de sa√∫de com problemas: " + response.status,
              "warning",
            );
            log("‚ö†Ô∏è API health: " + response.status);
          }
        } catch (e) {
          addStatus(
            "api-tests",
            "‚ùå API n√£o dispon√≠vel: " + e.message,
            "error",
          );
          log("‚ùå API erro: " + e.message);
        }

        // Testar rota b√°sica
        try {
          const response = await fetch("/");
          if (response.ok) {
            addStatus("api-tests", "‚úÖ Rota raiz acess√≠vel", "success");
            log("‚úÖ Rota / OK");
          } else {
            addStatus(
              "api-tests",
              "‚ö†Ô∏è Rota raiz com problemas: " + response.status,
              "warning",
            );
            log("‚ö†Ô∏è Rota /: " + response.status);
          }
        } catch (e) {
          addStatus(
            "api-tests",
            "‚ùå Rota raiz inacess√≠vel: " + e.message,
            "error",
          );
          log("‚ùå Rota / erro: " + e.message);
        }
      }

      // 4. Teste de Builder.io
      function testBuilder() {
        log("üèóÔ∏è Iniciando testes espec√≠ficos do Builder.io...");

        // Verificar por problemas conhecidos
        const bodyText = document.body.textContent || "";
        if (bodyText.includes("export default function")) {
          addStatus(
            "builder-tests",
            "üö® PROBLEMA CR√çTICO: C√≥digo React sendo exibido como texto!",
            "error",
          );
          log("üö® CR√çTICO: C√≥digo React como texto detectado");
        } else {
          addStatus(
            "builder-tests",
            "‚úÖ Nenhum c√≥digo React sendo exibido como texto",
            "success",
          );
          log("‚úÖ Sem c√≥digo React como texto");
        }

        // Verificar MyComponent
        if (bodyText.includes("MyComponent")) {
          addStatus(
            "builder-tests",
            "‚ö†Ô∏è Refer√™ncia a MyComponent detectada",
            "warning",
          );
          log("‚ö†Ô∏è MyComponent detectado");
        } else {
          addStatus(
            "builder-tests",
            "‚úÖ MyComponent n√£o detectado na tela",
            "success",
          );
          log("‚úÖ MyComponent n√£o vis√≠vel");
        }

        // Verificar se app principal est√° carregando
        const hasLegalFlow =
          bodyText.includes("LegalFlow") ||
          bodyText.includes("Software Jur√≠dico");
        if (hasLegalFlow) {
          addStatus("builder-tests", "‚úÖ Marca LegalFlow detectada", "success");
          log("‚úÖ LegalFlow branding OK");
        } else {
          addStatus(
            "builder-tests",
            "‚ö†Ô∏è Marca LegalFlow n√£o detectada",
            "warning",
          );
          log("‚ö†Ô∏è LegalFlow branding ausente");
        }
      }

      async function runAllTests() {
        log("üöÄ Iniciando bateria completa de testes...");

        // Limpar resultados anteriores
        ["env-tests", "react-tests", "api-tests", "builder-tests"].forEach(
          (id) => {
            document.getElementById(id).innerHTML = "";
          },
        );

        testEnvironment();
        await testReact();
        await testAPI();
        testBuilder();

        log("‚úÖ Todos os testes conclu√≠dos!");
      }

      function loadMainApp() {
        log("üè† Redirecionando para aplica√ß√£o principal...");
        window.location.href = "/";
      }

      // Executar testes automaticamente
      window.onload = () => {
        log("üß™ Sistema de testes iniciado");
        setTimeout(runAllTests, 1000);
      };
    </script>
  </body>
</html>
