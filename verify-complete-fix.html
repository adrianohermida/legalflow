<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LegalFlow - Verifica√ß√£o Completa</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: system-ui;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: 100vh;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 40px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 800px;
        width: 95%;
      }
      .test-result {
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        font-weight: 500;
        border-left: 4px solid;
      }
      .success {
        background: rgba(34, 197, 94, 0.1);
        color: #22c55e;
        border-left-color: #22c55e;
      }
      .error {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-left-color: #ef4444;
      }
      .warning {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border-left-color: #f59e0b;
      }
      .info {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border-left-color: #3b82f6;
      }
      h1 {
        color: #22c55e;
        margin-bottom: 30px;
        text-align: center;
      }
      h2 {
        margin: 25px 0 15px 0;
        color: #e2e8f0;
      }
      button {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px 5px;
        font-size: 14px;
        font-weight: 500;
      }
      button:hover {
        transform: translateY(-1px);
      }
      .log {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
        margin: 15px 0;
        max-height: 300px;
        overflow-y: auto;
        color: #e2e8f0;
        font-size: 12px;
      }
      .progress-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin: 20px 0;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #22c55e, #16a34a);
        width: 0%;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ LegalFlow - Verifica√ß√£o Completa de Carregamento</h1>

      <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
      </div>

      <h2>üîç Testes de Sistema</h2>
      <div id="system-tests"></div>

      <h2>‚öõÔ∏è Testes de React</h2>
      <div id="react-tests"></div>

      <h2>üåê Testes de Conectividade</h2>
      <div id="connectivity-tests"></div>

      <h2>üèóÔ∏è Testes de Builder.io</h2>
      <div id="builder-tests"></div>

      <h2>üìä Relat√≥rio Final</h2>
      <div id="final-report"></div>

      <h2>üìù Logs Detalhados</h2>
      <div id="detailed-logs" class="log"></div>

      <div style="text-align: center; margin-top: 30px">
        <button onclick="runCompleteVerification()" id="runBtn">
          üöÄ Executar Verifica√ß√£o Completa
        </button>
        <button onclick="loadMainApp()">üè† Carregar App Principal</button>
        <button onclick="window.location.reload()">üîÑ Recarregar Testes</button>
        <button onclick="openTestPage()">üß™ Abrir P√°gina de Teste</button>
      </div>
    </div>

    <script>
      let logs = [];
      let testsCompleted = 0;
      let totalTests = 12;
      let testResults = {
        system: { passed: 0, failed: 0 },
        react: { passed: 0, failed: 0 },
        connectivity: { passed: 0, failed: 0 },
        builder: { passed: 0, failed: 0 },
      };

      function log(message, level = "info") {
        const timestamp = new Date().toLocaleTimeString("pt-BR");
        const logEntry = `[${timestamp}] [${level.toUpperCase()}] ${message}`;
        logs.push(logEntry);
        updateLogs();
        console.log(logEntry);
      }

      function updateLogs() {
        document.getElementById("detailed-logs").textContent = logs
          .slice(-50)
          .join("\n");
      }

      function updateProgress() {
        const progress = (testsCompleted / totalTests) * 100;
        document.getElementById("progress").style.width = progress + "%";
      }

      function addResult(containerId, message, type, category) {
        const container = document.getElementById(containerId);
        const div = document.createElement("div");
        div.className = `test-result ${type}`;
        div.textContent = message;
        container.appendChild(div);

        testsCompleted++;
        if (type === "success") {
          testResults[category].passed++;
        } else if (type === "error") {
          testResults[category].failed++;
        }
        updateProgress();
      }

      // 1. Testes de Sistema
      function testSystem() {
        log("üîç Iniciando testes de sistema...");

        // Verificar environment
        const isBuilder =
          window.location.hostname.includes("builder.codes") ||
          window.location.hostname.includes("fly.dev");

        if (isBuilder) {
          addResult(
            "system-tests",
            "‚úÖ Ambiente Builder.io/Fly.dev detectado",
            "success",
            "system",
          );
          log("‚úÖ Executando em ambiente de produ√ß√£o");
        } else {
          addResult(
            "system-tests",
            "‚ö†Ô∏è Ambiente local detectado",
            "warning",
            "system",
          );
          log("‚ö†Ô∏è Executando em ambiente local");
        }

        // Verificar DOM
        if (document.getElementById("root")) {
          addResult(
            "system-tests",
            "‚úÖ Elemento #root encontrado",
            "success",
            "system",
          );
          log("‚úÖ DOM structure OK");
        } else {
          addResult(
            "system-tests",
            "‚ùå Elemento #root ausente",
            "error",
            "system",
          );
          log("‚ùå DOM structure problem");
        }

        // Verificar console
        if (typeof console !== "undefined" && console.log) {
          addResult(
            "system-tests",
            "‚úÖ Console funcional",
            "success",
            "system",
          );
          log("‚úÖ Console available");
        } else {
          addResult(
            "system-tests",
            "‚ùå Console n√£o dispon√≠vel",
            "error",
            "system",
          );
          log("‚ùå Console unavailable");
        }
      }

      // 2. Testes de React
      async function testReact() {
        log("‚öõÔ∏è Iniciando testes de React...");

        return new Promise((resolve) => {
          // Verificar se React j√° est√° dispon√≠vel
          if (typeof React !== "undefined") {
            addResult(
              "react-tests",
              "‚úÖ React j√° carregado",
              "success",
              "react",
            );
            log("‚úÖ React pre-loaded");
            testReactFunctionality();
            resolve();
          } else {
            // Carregar React via CDN
            const script = document.createElement("script");
            script.src =
              "https://unpkg.com/react@18/umd/react.production.min.js";
            script.onload = () => {
              if (typeof React !== "undefined") {
                addResult(
                  "react-tests",
                  "‚úÖ React carregado via CDN",
                  "success",
                  "react",
                );
                log("‚úÖ React loaded from CDN");
                testReactFunctionality();
              } else {
                addResult(
                  "react-tests",
                  "‚ùå Falha ao carregar React",
                  "error",
                  "react",
                );
                log("‚ùå React load failed");
              }
              resolve();
            };
            script.onerror = () => {
              addResult(
                "react-tests",
                "‚ùå Erro ao carregar React via CDN",
                "error",
                "react",
              );
              log("‚ùå React CDN error");
              resolve();
            };
            document.head.appendChild(script);
          }
        });
      }

      function testReactFunctionality() {
        try {
          // Testar createElement
          const element = React.createElement(
            "div",
            { className: "test" },
            "Test Element",
          );
          if (element && element.type === "div") {
            addResult(
              "react-tests",
              "‚úÖ React.createElement funcionando",
              "success",
              "react",
            );
            log("‚úÖ React.createElement OK");
          } else {
            addResult(
              "react-tests",
              "‚ùå React.createElement com problemas",
              "error",
              "react",
            );
            log("‚ùå React.createElement failed");
          }
        } catch (e) {
          addResult(
            "react-tests",
            "‚ùå Erro em React.createElement: " + e.message,
            "error",
            "react",
          );
          log("‚ùå React.createElement error: " + e.message);
        }

        // Testar hooks (se dispon√≠vel)
        try {
          if (React.useState) {
            addResult(
              "react-tests",
              "‚úÖ React Hooks dispon√≠veis",
              "success",
              "react",
            );
            log("‚úÖ React Hooks available");
          } else {
            addResult(
              "react-tests",
              "‚ö†Ô∏è React Hooks n√£o detectados",
              "warning",
              "react",
            );
            log("‚ö†Ô∏è React Hooks not detected");
          }
        } catch (e) {
          addResult(
            "react-tests",
            "‚ùå Erro ao verificar hooks: " + e.message,
            "error",
            "react",
          );
          log("‚ùå React Hooks error: " + e.message);
        }
      }

      // 3. Testes de Conectividade
      async function testConnectivity() {
        log("üåê Iniciando testes de conectividade...");

        // Testar rota raiz
        try {
          const response = await fetch("/", { method: "HEAD" });
          if (response.ok) {
            addResult(
              "connectivity-tests",
              "‚úÖ Rota raiz (/) acess√≠vel",
              "success",
              "connectivity",
            );
            log("‚úÖ Root route accessible");
          } else {
            addResult(
              "connectivity-tests",
              "‚ö†Ô∏è Rota raiz com status: " + response.status,
              "warning",
              "connectivity",
            );
            log("‚ö†Ô∏è Root route status: " + response.status);
          }
        } catch (e) {
          addResult(
            "connectivity-tests",
            "‚ùå Erro ao acessar rota raiz: " + e.message,
            "error",
            "connectivity",
          );
          log("‚ùå Root route error: " + e.message);
        }

        // Testar CDN do React
        try {
          const response = await fetch(
            "https://unpkg.com/react@18/umd/react.production.min.js",
            { method: "HEAD" },
          );
          if (response.ok) {
            addResult(
              "connectivity-tests",
              "‚úÖ CDN React acess√≠vel",
              "success",
              "connectivity",
            );
            log("‚úÖ React CDN accessible");
          } else {
            addResult(
              "connectivity-tests",
              "‚ö†Ô∏è CDN React com problemas: " + response.status,
              "warning",
              "connectivity",
            );
            log("‚ö†Ô∏è React CDN issues: " + response.status);
          }
        } catch (e) {
          addResult(
            "connectivity-tests",
            "‚ùå CDN React inacess√≠vel: " + e.message,
            "error",
            "connectivity",
          );
          log("‚ùå React CDN error: " + e.message);
        }

        // Testar conectividade geral
        try {
          const start = performance.now();
          await fetch("https://httpbin.org/delay/1");
          const duration = performance.now() - start;

          if (duration < 3000) {
            addResult(
              "connectivity-tests",
              `‚úÖ Conectividade externa OK (${Math.round(duration)}ms)`,
              "success",
              "connectivity",
            );
            log(`‚úÖ External connectivity: ${Math.round(duration)}ms`);
          } else {
            addResult(
              "connectivity-tests",
              `‚ö†Ô∏è Conectividade lenta (${Math.round(duration)}ms)`,
              "warning",
              "connectivity",
            );
            log(`‚ö†Ô∏è Slow connectivity: ${Math.round(duration)}ms`);
          }
        } catch (e) {
          addResult(
            "connectivity-tests",
            "‚ùå Problemas de conectividade externa",
            "error",
            "connectivity",
          );
          log("‚ùå External connectivity failed");
        }
      }

      // 4. Testes de Builder.io
      function testBuilder() {
        log("üèóÔ∏è Iniciando testes espec√≠ficos do Builder.io...");

        // Verificar se h√° c√≥digo React sendo exibido como texto
        const bodyText = document.body.textContent || "";
        if (
          bodyText.includes("export default function MyComponent") ||
          bodyText.includes("return <></>")
        ) {
          addResult(
            "builder-tests",
            "üö® CR√çTICO: C√≥digo React como texto detectado!",
            "error",
            "builder",
          );
          log("üö® CRITICAL: React code as text detected");
        } else {
          addResult(
            "builder-tests",
            "‚úÖ Nenhum c√≥digo React como texto",
            "success",
            "builder",
          );
          log("‚úÖ No React code as text");
        }

        // Verificar refer√™ncias problem√°ticas
        if (bodyText.includes("MyComponent")) {
          addResult(
            "builder-tests",
            "‚ö†Ô∏è Refer√™ncia a MyComponent detectada",
            "warning",
            "builder",
          );
          log("‚ö†Ô∏è MyComponent reference found");
        } else {
          addResult(
            "builder-tests",
            "‚úÖ Sem refer√™ncias problem√°ticas",
            "success",
            "builder",
          );
          log("‚úÖ No problematic references");
        }

        // Verificar marca LegalFlow
        if (
          bodyText.includes("LegalFlow") ||
          bodyText.includes("Software Jur√≠dico")
        ) {
          addResult(
            "builder-tests",
            "‚úÖ Marca LegalFlow presente",
            "success",
            "builder",
          );
          log("‚úÖ LegalFlow branding present");
        } else {
          addResult(
            "builder-tests",
            "‚ö†Ô∏è Marca LegalFlow n√£o detectada",
            "warning",
            "builder",
          );
          log("‚ö†Ô∏è LegalFlow branding missing");
        }
      }

      // Relat√≥rio Final
      function generateFinalReport() {
        log("üìä Gerando relat√≥rio final...");

        const total = testsCompleted;
        const totalPassed = Object.values(testResults).reduce(
          (sum, cat) => sum + cat.passed,
          0,
        );
        const totalFailed = Object.values(testResults).reduce(
          (sum, cat) => sum + cat.failed,
          0,
        );

        const reportContainer = document.getElementById("final-report");

        let reportHTML = `
                <div class="test-result info">
                    <strong>üìà Resumo Geral:</strong><br>
                    ‚úÖ Testes Passaram: ${totalPassed}<br>
                    ‚ùå Testes Falharam: ${totalFailed}<br>
                    üìä Taxa de Sucesso: ${Math.round((totalPassed / total) * 100)}%
                </div>
            `;

        Object.entries(testResults).forEach(([category, results]) => {
          const categoryTotal = results.passed + results.failed;
          const successRate =
            categoryTotal > 0
              ? Math.round((results.passed / categoryTotal) * 100)
              : 0;
          const status =
            successRate >= 80
              ? "success"
              : successRate >= 60
                ? "warning"
                : "error";

          reportHTML += `
                    <div class="test-result ${status}">
                        <strong>${category.toUpperCase()}:</strong> 
                        ${results.passed}/${categoryTotal} passou (${successRate}%)
                    </div>
                `;
        });

        // Recomenda√ß√µes
        if (totalFailed === 0) {
          reportHTML += `
                    <div class="test-result success">
                        <strong>üéâ TODOS OS TESTES PASSARAM!</strong><br>
                        Sistema LegalFlow est√° funcionando perfeitamente.
                    </div>
                `;
        } else if (totalPassed >= totalFailed) {
          reportHTML += `
                    <div class="test-result warning">
                        <strong>‚ö†Ô∏è SISTEMA FUNCIONAL COM ALERTAS</strong><br>
                        Maioria dos testes passou, mas h√° pontos de aten√ß√£o.
                    </div>
                `;
        } else {
          reportHTML += `
                    <div class="test-result error">
                        <strong>‚ùå PROBLEMAS CR√çTICOS DETECTADOS</strong><br>
                        Necess√°ria corre√ß√£o antes do uso em produ√ß√£o.
                    </div>
                `;
        }

        reportContainer.innerHTML = reportHTML;
        log("‚úÖ Relat√≥rio final gerado");
      }

      // Fun√ß√£o principal
      async function runCompleteVerification() {
        const runBtn = document.getElementById("runBtn");
        runBtn.disabled = true;
        runBtn.textContent = "üîÑ Executando...";

        // Limpar resultados anteriores
        [
          "system-tests",
          "react-tests",
          "connectivity-tests",
          "builder-tests",
          "final-report",
        ].forEach((id) => {
          document.getElementById(id).innerHTML = "";
        });

        logs = [];
        testsCompleted = 0;
        testResults = {
          system: { passed: 0, failed: 0 },
          react: { passed: 0, failed: 0 },
          connectivity: { passed: 0, failed: 0 },
          builder: { passed: 0, failed: 0 },
        };

        log("üöÄ Iniciando verifica√ß√£o completa do sistema LegalFlow...");

        try {
          testSystem();
          await testReact();
          await testConnectivity();
          testBuilder();

          setTimeout(() => {
            generateFinalReport();
            runBtn.disabled = false;
            runBtn.textContent = "‚úÖ Verifica√ß√£o Conclu√≠da";
            log("üéØ Verifica√ß√£o completa finalizada!");
          }, 1000);
        } catch (error) {
          log("‚ùå Erro durante verifica√ß√£o: " + error.message, "error");
          runBtn.disabled = false;
          runBtn.textContent = "‚ùå Erro na Verifica√ß√£o";
        }
      }

      function loadMainApp() {
        log("üè† Redirecionando para aplica√ß√£o principal...");
        window.location.href = "/";
      }

      function openTestPage() {
        window.open("/test-loading-complete.html", "_blank");
      }

      // Inicializa√ß√£o
      window.onload = () => {
        log("üß™ Sistema de verifica√ß√£o iniciado");
        log('üìå Use "Executar Verifica√ß√£o Completa" para come√ßar os testes');
      };
    </script>
  </body>
</html>
