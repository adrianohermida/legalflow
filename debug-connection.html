<!DOCTYPE html>
<html>
<head>
    <title>Debug - Conex√£o LegalFlow</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .warning { background: #fff3cd; }
    </style>
</head>
<body>
    <h1>üîç Debug - Conectividade LegalFlow</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function addResult(title, status, message, details) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <p><strong>Status:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }

        // Test 1: Basic connectivity
        addResult('1. Conectividade B√°sica', 'success', 'P√°gina carregou com sucesso', 
            `URL: ${window.location.href}\nUser Agent: ${navigator.userAgent.slice(0, 60)}...`);

        // Test 2: API Health
        fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                addResult('2. API Health', 'success', 'API respondendo normalmente', JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('2. API Health', 'error', 'Erro na API', error.toString());
            });

        // Test 3: API Ping
        fetch('/api/ping')
            .then(response => response.json())
            .then(data => {
                addResult('3. API Ping', 'success', 'Ping funcionando', JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('3. API Ping', 'error', 'Erro no Ping', error.toString());
            });

        // Test 4: API V1
        fetch('/api/v1')
            .then(response => response.json())
            .then(data => {
                addResult('4. API V1', 'success', 'API V1 funcionando', JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('4. API V1', 'error', 'Erro na API V1', error.toString());
            });

        // Test 5: Check for external calls
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            if (typeof url === 'string' && (url.includes('fly.dev') || url.includes('768d26c55b984ccba53ccd7956540206'))) {
                addResult('5. ALERTA', 'warning', 'Tentativa de conex√£o externa detectada!', `URL: ${url}`);
                console.error('üö® EXTERNAL CALL DETECTED:', url);
            }
            return originalFetch.apply(this, args);
        };

        // Test 6: Environment check
        addResult('6. Configura√ß√£o de Ambiente', 'success', 'Verificando vari√°veis...', 
            `Location: ${window.location.origin}\nProtocol: ${window.location.protocol}\nHost: ${window.location.host}`);

        setTimeout(() => {
            addResult('7. Monitoramento Ativo', 'success', 'Sistema monitorando chamadas externas por 30 segundos...');
        }, 1000);
    </script>
</body>
</html>
