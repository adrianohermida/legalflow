<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LegalFlow - Software Jur√≠dico Inteligente</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { 
        font-family: system-ui; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      #root { min-height: 100vh; }
      .loading-fallback {
        display: flex; 
        align-items: center; 
        justify-content: center; 
        min-height: 100vh; 
        color: white; 
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading-fallback">
        <div style="background: white; color: #333; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
          <h1 style="color: #667eea; margin-bottom: 20px;">‚ö° LegalFlow</h1>
          <p>Software Jur√≠dico Inteligente</p>
          <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; color: #1e40af;">
            Carregando aplica√ß√£o...
          </div>
        </div>
      </div>
    </div>

    <!-- Load the main React application -->
    <script type="module" src="/client/App.tsx"></script>
    
    <script>
      // Builder.io protection system - only fix if problematic code appears
      function builderIoProtection() {
        const bodyText = document.body.textContent || '';
        
        // Check for the EXACT problematic code that shouldn't appear as text
        const problematicStrings = [
          'export default function MyComponent(props) { return <></>;',
          'export default function MyComponent',
          'function MyComponent(props)',
          'return <></>;'
        ];
        
        let needsProtection = false;
        for (const str of problematicStrings) {
          if (bodyText.includes(str)) {
            needsProtection = true;
            console.error('üö® BUILDER.IO PROTECTION: Code detected as text:', str);
            break;
          }
        }
        
        // Only apply protection if actually needed
        if (needsProtection) {
          console.log('üõ°Ô∏è Applying Builder.io protection...');
          // Reload to let React take over properly
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        }
        
        return needsProtection;
      }
      
      // Monitor for issues but don't interfere with normal React loading
      const isBuilderIo = window.location.hostname.includes('builder.codes') || 
                          window.location.hostname.includes('fly.dev') ||
                          window.location.hostname.includes('builder.io');
      
      if (isBuilderIo) {
        console.log('üèóÔ∏è Builder.io environment detected - protection active');
        
        // Check periodically for the first 10 seconds only
        let checkCount = 0;
        const protectionInterval = setInterval(() => {
          checkCount++;
          builderIoProtection();
          
          if (checkCount >= 20) { // Stop after 10 seconds (500ms * 20)
            clearInterval(protectionInterval);
            console.log('üîç Builder.io protection monitoring complete');
          }
        }, 500);
      }
      
      // React app loading monitor
      setTimeout(() => {
        const reactLoaded = document.getElementById('root')?.getAttribute('data-react-loaded');
        if (!reactLoaded) {
          console.log('‚ö†Ô∏è React app may not have loaded properly, checking for issues...');
          builderIoProtection();
        } else {
          console.log('‚úÖ React app loaded successfully');
        }
      }, 3000);
    </script>
  </body>
</html>
