<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LegalFlow - Software Jur√≠dico Inteligente</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { 
        font-family: system-ui; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      #root { min-height: 100vh; }
      .loading-fallback {
        display: flex; 
        align-items: center; 
        justify-content: center; 
        min-height: 100vh; 
        color: white; 
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading-fallback">
        <div style="background: white; color: #333; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
          <h1 style="color: #667eea; margin-bottom: 20px;">‚ö° LegalFlow</h1>
          <p>Software Jur√≠dico Inteligente</p>
          <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; color: #1e40af;">
            Carregando aplicativo LegalFlow...
          </div>
        </div>
      </div>
    </div>

    <!-- APLICATIVO LEGALFLOW VERDADEIRO -->
    <script type="module" src="/client/App.tsx"></script>

    <script>
      // PROTE√á√ÉO BUILDER.IO - Apenas para casos espec√≠ficos
      let reloadAttempts = 0;
      const MAX_RELOAD_ATTEMPTS = 1; // Reduzido para 1 tentativa apenas
      
      // Ler contador do sessionStorage
      try {
        const storedAttempts = sessionStorage.getItem('builderReloadAttempts');
        if (storedAttempts) {
          reloadAttempts = parseInt(storedAttempts, 10) || 0;
        }
      } catch (e) {
        // Ignore sessionStorage errors
      }
      
      function smartBuilderProtection() {
        // N√£o executar se j√° tentamos reloads
        if (reloadAttempts >= MAX_RELOAD_ATTEMPTS) {
          console.log('üõ°Ô∏è Builder.io protection: Disabled - max attempts reached');
          return false;
        }
        
        const bodyText = document.body.textContent || '';
        
        // DETEC√á√ÉO ULTRA-ESPEC√çFICA - apenas o c√≥digo exato problem√°tico
        const exactProblematicCode = 'export default function MyComponent(props) { return <></>;';
        
        if (bodyText.includes(exactProblematicCode)) {
          reloadAttempts++;
          console.error('üö® EXACT Builder.io issue detected - applying single reload fix');
          
          // Armazenar contador
          try {
            sessionStorage.setItem('builderReloadAttempts', reloadAttempts.toString());
          } catch (e) {
            // Ignore
          }
          
          setTimeout(() => {
            window.location.reload();
          }, 1000);
          
          return true;
        }
        
        return false;
      }
      
      // PROTE√á√ÉO APENAS EM PRODU√á√ÉO
      const isProduction = window.location.hostname.includes('builder.codes') || 
                          window.location.hostname.includes('fly.dev') ||
                          window.location.hostname.includes('builder.io');
      
      if (isProduction && reloadAttempts < MAX_RELOAD_ATTEMPTS) {
        console.log('üèóÔ∏è Production environment - minimal protection active');
        
        // Verificar uma √∫nica vez ap√≥s 4 segundos
        setTimeout(() => {
          if (!smartBuilderProtection()) {
            console.log('‚úÖ Builder.io protection: No issues detected');
            
            // Limpar contador se tudo OK
            try {
              sessionStorage.removeItem('builderReloadAttempts');
            } catch (e) {
              // Ignore
            }
          }
        }, 4000);
      }
      
      // DETECTAR SUCESSO DO CARREGAMENTO DO APP
      setTimeout(() => {
        const reactLoaded = document.getElementById('root')?.getAttribute('data-react-loaded');
        const appStatus = document.getElementById('root')?.getAttribute('data-app-status');
        
        if (reactLoaded && appStatus) {
          console.log('‚úÖ LegalFlow app loaded successfully');
          console.log('üì± App status:', appStatus);
          
          // Limpar contador quando app carrega
          try {
            sessionStorage.removeItem('builderReloadAttempts');
          } catch (e) {
            // Ignore
          }
        } else {
          console.log('‚ö†Ô∏è LegalFlow app may still be loading...');
        }
      }, 6000);
      
      console.log('üöÄ LegalFlow - Initializing full application...');
    </script>
  </body>
</html>
