<!DOCTYPE html>
<html>
<head>
    <title>üîß MyComponent Fix Validation</title>
    <style>
        body { font-family: system-ui; margin: 20px; background: #f8f9fa; }
        .test { margin: 15px 0; padding: 20px; border-radius: 8px; }
        .pass { background: #d4edda; border: 2px solid #c3e6cb; }
        .fail { background: #f8d7da; border: 2px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 2px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; }
        .result { font-weight: bold; font-size: 1.1em; }
    </style>
</head>
<body>
    <h1>üîß LegalFlow - MyComponent Fix Validation</h1>
    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');
        
        function addTest(status, title, details) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <div class="result">${title}</div>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }

        // Test 1: Check if MyComponent exists and is importable
        addTest('info', 'üîç Test 1: MyComponent Import Test', 'Testing if MyComponent can be imported...');
        
        try {
            const myComponentModule = await import('/client/MyComponent.tsx');
            const hasDefaultExport = !!myComponentModule.default;
            
            if (hasDefaultExport) {
                const componentString = myComponentModule.default.toString();
                const isEmptyComponent = componentString.includes('return <></>') || 
                                       componentString.includes('return <>');
                
                if (isEmptyComponent) {
                    addTest('fail', '‚ùå Test 1: FAILED - Component Still Empty', 
                        'MyComponent still returns empty JSX. The fix did not work.');
                } else {
                    addTest('pass', '‚úÖ Test 1: PASSED - Component Has Content', 
                        'MyComponent now has proper content and redirects to main app.');
                }
            } else {
                addTest('fail', '‚ùå Test 1: FAILED - No Default Export', 
                    'MyComponent exists but has no default export.');
            }
        } catch (error) {
            addTest('fail', '‚ùå Test 1: FAILED - Import Error', 
                `Could not import MyComponent: ${error.message}`);
        }

        // Test 2: Check Builder.io component registry
        addTest('info', 'üîç Test 2: Builder Registry Test', 'Checking Builder.io component registry...');
        
        try {
            const builderFixModule = await import('/client/lib/builder-fix.ts');
            const hasMyComponent = !!builderFixModule.MyComponent;
            const hasRegistry = !!builderFixModule.default;
            
            addTest(hasMyComponent && hasRegistry ? 'pass' : 'fail',
                hasMyComponent && hasRegistry ? 
                    '‚úÖ Test 2: PASSED - Registry Working' : 
                    '‚ùå Test 2: FAILED - Registry Missing',
                `MyComponent in registry: ${hasMyComponent}\nRegistry exists: ${hasRegistry}`);
        } catch (error) {
            addTest('fail', '‚ùå Test 2: FAILED - Registry Error', 
                `Builder registry error: ${error.message}`);
        }

        // Test 3: Check if main React app loads correctly
        addTest('info', 'üîç Test 3: Main App Load Test', 'Testing main React app loading...');
        
        try {
            const appModule = await import('/client/App.tsx');
            const hasApp = !!appModule.default;
            
            addTest(hasApp ? 'pass' : 'fail',
                hasApp ? 
                    '‚úÖ Test 3: PASSED - Main App Loads' : 
                    '‚ùå Test 3: FAILED - Main App Missing',
                `App component available: ${hasApp}`);
        } catch (error) {
            addTest('fail', '‚ùå Test 3: FAILED - App Load Error', 
                `Main app error: ${error.message}`);
        }

        // Test 4: Environment verification
        const environment = window.location.hostname.includes('builder.codes') ? 'Builder.io Production' : 
                           window.location.hostname.includes('fly.dev') ? 'Fly.dev Production' : 'Development';
        
        addTest('info', 'üåê Test 4: Environment Check', 
            `Environment: ${environment}\nURL: ${window.location.href}\nBuilder Components Available: ${!!(window as any).BuilderComponents}`);

        // Test 5: Final recommendation
        setTimeout(() => {
            const builderComponents = (window as any).BuilderComponents;
            const hasBuilderComponentsRegistry = !!builderComponents;
            const hasMyComponentInRegistry = hasBuilderComponentsRegistry && !!builderComponents.MyComponent;
            
            if (hasMyComponentInRegistry) {
                addTest('pass', 'üéâ FINAL RESULT: FIX SUCCESSFUL', 
                    'MyComponent fix implemented successfully. Builder.io should no longer show empty components.');
            } else {
                addTest('fail', 'üö® FINAL RESULT: FIX INCOMPLETE', 
                    'Builder.io registry not properly initialized. Additional work needed.');
            }
        }, 2000);

        // Test 6: API Health Check
        fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                addTest('pass', '‚úÖ API Health: WORKING', 
                    `Backend API is responding correctly.\nStatus: ${data.message}`);
            })
            .catch(error => {
                addTest('fail', '‚ùå API Health: FAILED', 
                    `Backend API error: ${error.message}`);
            });
    </script>
</body>
</html>
